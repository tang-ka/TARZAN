#include "stdafx.h"
#include "USpotLightComponent.h"


USpotLightComponent::USpotLightComponent() {
    ObjType = EObjectType::Object;
    isBill = false;

    // blender로 만들고 obj파일 바꿔서 만듦. rgba값은 필요 없으니 1.f로 고정
    vertices = {
        {-0.000000,  0.000000, -0.000000, 1.0, 1.0, 1.0, 1.0},
        {-0.000000,  3.000000, -1.000000, 1.0, 1.0, 1.0, 1.0},
        {-0.195090,  3.000000, -0.980785, 1.0, 1.0, 1.0, 1.0},
        {-0.382683,  3.000000, -0.923879, 1.0, 1.0, 1.0, 1.0},
        {-0.555570,  3.000000, -0.831469, 1.0, 1.0, 1.0, 1.0},
        {-0.707107,  3.000000, -0.707107, 1.0, 1.0, 1.0, 1.0},
        {-0.831470,  3.000000, -0.555570, 1.0, 1.0, 1.0, 1.0},
        {-0.923880,  3.000000, -0.382683, 1.0, 1.0, 1.0, 1.0},
        {-0.980785,  3.000000, -0.195090, 1.0, 1.0, 1.0, 1.0},
        {-1.000000,  3.000000,  0.000000, 1.0, 1.0, 1.0, 1.0},
        {-0.980785,  3.000000,  0.195090, 1.0, 1.0, 1.0, 1.0},
        {-0.923880,  3.000000,  0.382684, 1.0, 1.0, 1.0, 1.0},
        {-0.831470,  3.000000,  0.555570, 1.0, 1.0, 1.0, 1.0},
        {-0.707107,  3.000000,  0.707107, 1.0, 1.0, 1.0, 1.0},
        {-0.555570,  3.000000,  0.831470, 1.0, 1.0, 1.0, 1.0},
        {-0.382683,  3.000000,  0.923880, 1.0, 1.0, 1.0, 1.0},
        {-0.195090,  3.000000,  0.980785, 1.0, 1.0, 1.0, 1.0},
        {0.000000,  3.000000,  1.000000, 1.0, 1.0, 1.0, 1.0},
        {0.195090,  3.000000,  0.980785, 1.0, 1.0, 1.0, 1.0},
        {0.382683,  3.000000,  0.923880, 1.0, 1.0, 1.0, 1.0},
        {0.555570,  3.000000,  0.831470, 1.0, 1.0, 1.0, 1.0},
        {0.707107,  3.000000,  0.707107, 1.0, 1.0, 1.0, 1.0},
        {0.831470,  3.000000,  0.555570, 1.0, 1.0, 1.0, 1.0},
        {0.923880,  3.000000,  0.382684, 1.0, 1.0, 1.0, 1.0},
        {0.980785,  3.000000,  0.195090, 1.0, 1.0, 1.0, 1.0},
        {1.000000,  3.000000,  0.000000, 1.0, 1.0, 1.0, 1.0},
        {0.980785,  3.000000, -0.195090, 1.0, 1.0, 1.0, 1.0},
        {0.923880,  3.000000, -0.382683, 1.0, 1.0, 1.0, 1.0},
        {0.831470,  3.000000, -0.555570, 1.0, 1.0, 1.0, 1.0},
        {0.707107,  3.000000, -0.707107, 1.0, 1.0, 1.0, 1.0},
        {0.555570,  3.000000, -0.831469, 1.0, 1.0, 1.0, 1.0},
        {0.382683,  3.000000, -0.923879, 1.0, 1.0, 1.0, 1.0},
        {0.195090,  3.000000, -0.980785, 1.0, 1.0, 1.0, 1.0}
    };

    // 일단 밑면은 할당하지 않음.
    indices =
    {
        0, 1, 2,
        0, 2, 3,
        0, 3, 4,
        0, 4, 5,
        0, 5, 6,
        0, 6, 7,
        0, 7, 8,
        0, 8, 9,
        0, 9, 10,
        0, 10, 11,
        0, 11, 12,
        0, 12, 13,
        0, 13, 14,
        0, 14, 15,
        0, 15, 16,
        0, 16, 17,
        0, 17, 18,
        0, 18, 19,
        0, 19, 20,
        0, 20, 21,
        0, 21, 22,
        0, 22, 23,
        0, 23, 24,
        0, 24, 25,
        0, 25, 26,
        0, 26, 27,
        0, 27, 28,
        0, 28, 29,
        0, 29, 30,
        0, 30, 31,
        0, 31, 32,
        0, 32, 1
    };


	CGraphics* graphics = CRenderer::Instance()->GetGraphics();
	_vertexBuffer = std::make_unique<CVertexBuffer<FVertexSimple>>(graphics->GetDevice());
	_vertexBuffer->Create(vertices);
	_indexBuffer = std::make_unique<CIndexBuffer>(graphics->GetDevice());
	_indexBuffer->Create(indices);

    // 영상에서는 plane으로 나왔음.
	CreateBoundingBox(EPrimitiveType::SPOTLIGHT);
}

void USpotLightComponent::CreateBoundingBox(EPrimitiveType type)
{
	boundingBox = new FBoundingBox();
	boundingBox->SetBoundaryPointsForPrimitive(type);
	boundingBox->GenerateVertices();
	boundingBox->GenerateIndices();
	//isShowBoundingBox = true;
}